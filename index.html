<!DOCTYPE html>
<html>
<head>
    <title>个人问答挑战</title>
    <style>
        .page { display: none; padding: 20px; }
        .active { display: block; }
        table { border-collapse: collapse; margin: 20px 0; }
        td, th { border: 1px solid #ddd; padding: 8px; }
        .correct { color: green; }
        .wrong { color: red; }
    </style>
</head>
<body>
    <!-- 注册页面 -->
    <div id="registerPage" class="page active">
        <h2>欢迎参加知识挑战!</h2>
        <p>用户名：<input type="text" id="username">
        <button onclick="checkUsername()">开始挑战</button></p>
        <p id="usernameError" style="color:red"></p>
    </div>

    <!-- 答题页面 -->
    <div id="quizPage" class="page">
        <h2>知识挑战 (<span id="currentUser"></span>)</h2>
        <form id="quizForm" onsubmit="return submitQuiz(event)"></form>
        <p>已用时：<span id="timer">0</span>秒</p>
    </div>

    <!-- 结果页面 -->
    <div id="resultPage" class="page">
        <h2>挑战结果</h2>
        <div id="personalResult"></div>
        <h3>排行榜</h3>
        <div id="ranking"></div>
        <button onclick="showPage('registerPage')">返回首页</button>
    </div>

<script>
// 题目配置
const questions = [
            {
                question: "我的身高大约是？",
                options: ["160以下", "160-165", "166-170", "171-180"],
                answer: 3
            },
            {
                question: "我常玩的游戏不包括以下哪项？",
                options: ["和平精英", "王者荣耀", "金铲铲", "明日之后"],
                answer: 2
            },
            {
                question: "我的爱好不包括以下哪项？",
                options: ["吉他", "游泳", "台球", "打游戏"],
                answer: 1
            }

];

let startTime;
let timerInterval;
let currentUser = "";

// 初始化题目
function initQuiz() {
    const form = document.getElementById("quizForm");
    form.innerHTML = questions.map((q, i) => `
        <div>
            <p>${i+1}. ${q.question}</p>
            ${q.options.map((o, j) => `
                <label>
                    <input type="radio" name="q${i}" value="${j}" required>
                    ${o}
                </label>
            `).join("")}
        </div>
    `).join("") + '<button type="submit">提交答案</button>';
}

// 用户名检查
function checkUsername() {
    const username = document.getElementById("username").value.trim();
    const errorEl = document.getElementById("usernameError");
    
    if (!username) {
        errorEl.textContent = "用户名不能为空";
        return;
    }

    const users = JSON.parse(localStorage.getItem("users") || "[]");
    if (users.some(u => u.username === username)) {
        errorEl.textContent = "用户名已存在";
        return;
    }

    errorEl.textContent = "";
    currentUser = username;
    document.getElementById("currentUser").textContent = username;
    showPage("quizPage");
    startTime = Date.now();
    timerInterval = setInterval(() => {
        document.getElementById("timer").textContent = 
            Math.floor((Date.now() - startTime)/1000);
    }, 1000);
    initQuiz();
}

// 提交答案
function submitQuiz(e) {
    e.preventDefault();
    clearInterval(timerInterval);
    const timeUsed = Math.floor((Date.now() - startTime)/1000);
    
    // 计算得分
    const formData = new FormData(e.target);
    const answers = questions.map((q, i) => ({
        question: q.question,
        selected: parseInt(formData.get(`q${i}`)),
        correct: q.answer
    }));

    const correctCount = answers.filter(a => a.selected === a.correct).length;
    const accuracy = (correctCount / questions.length * 100).toFixed(1);

    // 保存记录
    const userData = {
        username: currentUser,
        time: timeUsed,
        accuracy: accuracy,
        answers: answers,
        timestamp: new Date().toISOString()
    };

    const users = JSON.parse(localStorage.getItem("users") || "[]");
    users.push(userData);
    localStorage.setItem("users", JSON.stringify(users));

    showResult(userData);
    showPage("resultPage");
    return false;
}

// 显示结果
function showResult(userData) {
    const personalResult = document.getElementById("personalResult");
    personalResult.innerHTML = `
        <h4>${userData.username} 的答题结果 (正确率：${userData.accuracy}%)</h4>
        <p>我想说的话：感谢参与！希望你喜欢这个挑战</p>
        <table>
            <tr><th>题目</th><th>你的答案</th><th>正确答案</th></tr>
            ${userData.answers.map((a, i) => `
                <tr>
                    <td>${i+1}. ${a.question}</td>
                    <td class="${a.selected === a.correct ? 'correct' : 'wrong'}">
                        ${questions[i].options[a.selected]}
                    </td>
                    <td>${questions[i].options[a.correct]}</td>
                </tr>
            `).join("")}
        </table>
    `;

    // 生成排行榜
    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const sortedUsers = [...users].sort((a,b) => b.accuracy - a.accuracy);
    
    document.getElementById("ranking").innerHTML = `
        <table>
            <tr><th>排名</th><th>用户名</th><th>正确率</th><th>用时</th></tr>
            ${sortedUsers.map((u,i) => `
                <tr>
                    <td>${i+1}</td>
                    <td><a href="javascript:showUserDetail('${u.username}')">${u.username}</a></td>
                    <td>${u.accuracy}%</td>
                    <td>${u.time}秒</td>
                </tr>
            `).join("")}
        </table>
    `;
}

// 查看用户详情
function showUserDetail(username) {
    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const user = users.find(u => u.username === username);
    alert(`用户 ${username} 的答题记录：
时间：${user.time}秒
正确率：${user.accuracy}%
答题时间：${new Date(user.timestamp).toLocaleString()}`);
}

function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
}

// 初始化页面时清空可能存在的用户输入
window.onload = initQuiz;
</script>
</body>
</html>
