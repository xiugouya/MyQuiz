<!DOCTYPE html>
<html>
<head>
    <title>ä¸ªäººçŸ¥è¯†æŒ‘æˆ˜</title>
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #607D8B;
            --success-color: #4CAF50;
            --error-color: #f44336;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .page {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease;
        }

        .active {
            display: block;
        }

        h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        input[type="text"] {
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 4px;
            width: 250px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 1rem;
        }

        button:hover {
            background: #1976D2;
        }

        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin: 1rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: var(--primary-color);
            color: white;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .correct { color: var(--success-color); }
        .wrong { color: var(--error-color); }

        #usernameError {
            margin-top: 0.5rem;
            color: var(--error-color);
            font-weight: bold;
        }

        .ranking-link {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }

        .ranking-link:hover {
            text-decoration: underline;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- æ³¨å†Œé¡µé¢ -->
    <div id="registerPage" class="page active">
        <h2>ğŸ“ ç”¨æˆ·æ³¨å†Œ</h2>
        <div class="card">
            <p>è¯·è¾“å…¥ç”¨æˆ·åå¼€å§‹æŒ‘æˆ˜ï¼š</p>
            <input type="text" id="username" placeholder="è¾“å…¥ç”¨æˆ·å...">
            <button onclick="checkUsername()">å¼€å§‹æŒ‘æˆ˜</button>
            <p id="usernameError"></p>
        </div>
        <div class="card">
            <h3>ğŸ† å½“å‰æ’è¡Œæ¦œ</h3>
            <div id="previewRanking"></div>
        </div>
    </div>

    <!-- ç­”é¢˜é¡µé¢ -->
    <div id="quizPage" class="page">
        <h2>ğŸ§  çŸ¥è¯†æŒ‘æˆ˜ (<span id="currentUser"></span>)</h2>
        <div class="card">
            <form id="quizForm" onsubmit="return submitQuiz(event)"></form>
            <p>â³ å·²ç”¨æ—¶ï¼š<span id="timer">0</span>ç§’</p>
        </div>
    </div>

    <!-- ç»“æœé¡µé¢ -->
    <div id="resultPage" class="page">
        <h2>ğŸ¯ æŒ‘æˆ˜ç»“æœ</h2>
        <div class="card">
            <div id="personalResult"></div>
            <h3>ğŸ… æ’è¡Œæ¦œ</h3>
            <div id="ranking"></div>
            <button onclick="showPage('registerPage')">è¿”å›é¦–é¡µ</button>
        </div>
    </div>

<script>
// é¢˜ç›®é…ç½®
const questions = [
    {
                question: "æˆ‘çš„èº«é«˜å¤§çº¦æ˜¯ï¼Ÿ",
                options: ["160ä»¥ä¸‹", "160-165", "166-170", "171-180"],
                answer: 3
            },
            {
                question: "æˆ‘å¸¸ç©çš„æ¸¸æˆä¸åŒ…æ‹¬ä»¥ä¸‹å“ªé¡¹ï¼Ÿ",
                options: ["å’Œå¹³ç²¾è‹±", "ç‹è€…è£è€€", "é‡‘é“²é“²", "æ˜æ—¥ä¹‹å"],
                answer: 2
            },
            {
                question: "æˆ‘çš„çˆ±å¥½ä¸åŒ…æ‹¬ä»¥ä¸‹å“ªé¡¹ï¼Ÿ",
                options: ["å‰ä»–", "æ¸¸æ³³", "å°çƒ", "æ‰“æ¸¸æˆ"],
                answer: 1
            }
];

let startTime;
let timerInterval;
let currentUser = "";

// åˆå§‹åŒ–é¢„è§ˆæ’è¡Œæ¦œ
function initPreviewRanking() {
    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const sortedUsers = [...users].sort((a,b) => b.accuracy - a.accuracy).slice(0, 5);
    
    document.getElementById("previewRanking").innerHTML = sortedUsers.length > 0 ? `
        <table>
            <tr><th>æ’å</th><th>ç”¨æˆ·å</th><th>æ­£ç¡®ç‡</th></tr>
            ${sortedUsers.map((u,i) => `
                <tr>
                    <td>${i+1}</td>
                    <td>${u.username}</td>
                    <td>${u.accuracy}%</td>
                </tr>
            `).join("")}
        </table>
    ` : "<p>æš‚æ— æŒ‘æˆ˜è®°å½•ï¼Œå¿«æ¥æˆä¸ºç¬¬ä¸€ä¸ªæŒ‘æˆ˜è€…å§ï¼</p>";
}

// åˆå§‹åŒ–é¢˜ç›®
function initQuiz() {
    const form = document.getElementById("quizForm");
    form.innerHTML = questions.map((q, i) => `
        <div style="margin: 1.5rem 0;">
            <p style="font-weight: 500;">${i+1}. ${q.question}</p>
            <div style="display: grid; gap: 0.8rem;">
                ${q.options.map((o, j) => `
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="radio" name="q${i}" value="${j}" required>
                        ${o}
                    </label>
                `).join("")}
            </div>
        </div>
    `).join("") + '<button type="submit">æäº¤ç­”æ¡ˆ</button>';
}

// ç”¨æˆ·åæ£€æŸ¥
function checkUsername() {
    const username = document.getElementById("username").value.trim();
    const errorEl = document.getElementById("usernameError");
    
    if (!username) {
        errorEl.textContent = "âš ï¸ ç”¨æˆ·åä¸èƒ½ä¸ºç©º";
        return;
    }

    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const existingUser = users.find(u => u.username === username);

    if (existingUser) {
        showResult(existingUser);
        showPage("resultPage");
        errorEl.textContent = "âš ï¸ è¯¥ç”¨æˆ·åå·²å­˜åœ¨ï¼Œå·²ä¸ºæ‚¨æ˜¾ç¤ºå†å²æˆç»©";
        return;
    }

    errorEl.textContent = "";
    currentUser = username;
    document.getElementById("currentUser").textContent = username;
    showPage("quizPage");
    startTime = Date.now();
    timerInterval = setInterval(() => {
        document.getElementById("timer").textContent = 
            Math.floor((Date.now() - startTime)/1000);
    }, 1000);
    initQuiz();
}
// æäº¤ç­”æ¡ˆ
function submitQuiz(e) {
    e.preventDefault();
    clearInterval(timerInterval);
    const timeUsed = Math.floor((Date.now() - startTime)/1000);
    
    // è®¡ç®—å¾—åˆ†
    const formData = new FormData(e.target);
    const answers = questions.map((q, i) => ({
        question: q.question,
        selected: parseInt(formData.get(`q${i}`)),
        correct: q.answer
    }));

    const correctCount = answers.filter(a => a.selected === a.correct).length;
    const accuracy = (correctCount / questions.length * 100).toFixed(1);

    // ä¿å­˜è®°å½•
    const userData = {
        username: currentUser,
        time: timeUsed,
        accuracy: accuracy,
        answers: answers,
        timestamp: new Date().toISOString()
    };

    const users = JSON.parse(localStorage.getItem("users") || "[]");
    users.push(userData);
    localStorage.setItem("users", JSON.stringify(users));

    showResult(userData);
    showPage("resultPage");
    return false;
}

// æ˜¾ç¤ºç»“æœ
function showResult(userData) {
    const personalResult = document.getElementById("personalResult");
    personalResult.innerHTML = `
        <h4>${userData.username} çš„ç­”é¢˜ç»“æœ (æ­£ç¡®ç‡ï¼š${userData.accuracy}%)</h4>
        <h3>ğŸ‰ ç‰¹åˆ«é¸£è°¢</h3>
            <p>æœ¬æµ‹è¯•ç”±âŒˆä¿®å‹¾âŒ‹åˆ¶ä½œï¼Œæ„Ÿè°¢ä»¥ä¸‹æ”¯æŒï¼š</p>
            <ul>
                <li>æŠ€æœ¯æŒ‡å¯¼ï¼šæ¸å†·</li>
                <li>çµæ„Ÿæ¥æºï¼šæ¸å†·</li>
                <li>ç‰¹åˆ«æ„Ÿè°¢ï¼šæ¸å†·</li>
            </ul>
        <table>
            <tr><th>é¢˜ç›®</th><th>ä½ çš„ç­”æ¡ˆ</th><th>æ­£ç¡®ç­”æ¡ˆ</th></tr>
            ${userData.answers.map((a, i) => `
                <tr>
                    <td>${i+1}. ${a.question}</td>
                    <td class="${a.selected === a.correct ? 'correct' : 'wrong'}">
                        ${questions[i].options[a.selected]}
                    </td>
                    <td>${questions[i].options[a.correct]}</td>
                </tr>
            `).join("")}
        </table>
    `;

    // ç”Ÿæˆæ’è¡Œæ¦œ
    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const sortedUsers = [...users].sort((a,b) => b.accuracy - a.accuracy);
    
    document.getElementById("ranking").innerHTML = `
        <table>
            <tr><th>æ’å</th><th>ç”¨æˆ·å</th><th>æ­£ç¡®ç‡</th><th>ç”¨æ—¶</th></tr>
            ${sortedUsers.map((u,i) => `
                <tr>
                    <td>${i+1}</td>
                    <td><a href="javascript:showUserDetail('${u.username}')">${u.username}</a></td>
                    <td>${u.accuracy}%</td>
                    <td>${u.time}ç§’</td>
                </tr>
            `).join("")}
        </table>
    `;
}

// æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
function showUserDetail(username) {
    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const user = users.find(u => u.username === username);
    
    let detailMessage = `ç”¨æˆ· ${username} çš„ç­”é¢˜è¯¦æƒ…\n`;
    detailMessage += `â”œâ”€ ç”¨æ—¶ï¼š${user.time}ç§’\n`;
    detailMessage += `â”œâ”€ æ­£ç¡®ç‡ï¼š${user.accuracy}%\n`;
    detailMessage += `â””â”€ ç­”é¢˜æ—¶é—´ï¼š${new Date(user.timestamp).toLocaleString()}\n\n`;

    user.answers.forEach((answer, index) => {
        const question = questions.find(q => q.question === answer.question);
        if (question) {
            detailMessage += `é¢˜ç›® ${index+1}ï¼š${answer.question}\n`;
            detailMessage += `â”œâ”€ ä½ çš„é€‰æ‹©ï¼š${question.options[answer.selected]} ${answer.selected === answer.correct ? 'âœ…' : 'âŒ'}\n`;
            detailMessage += `â””â”€ æ­£ç¡®ç­”æ¡ˆï¼š${question.options[answer.correct]}\n\n`;
        }
    });

    alert(detailMessage);
}

function showPage(pageId) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
}

// åˆå§‹åŒ–é¡µé¢æ—¶æ¸…ç©ºå¯èƒ½å­˜åœ¨çš„ç”¨æˆ·è¾“å…¥
    window.onload = function() {
    initQuiz();
    initPreviewRanking();
};
</script>
</script>
</body>
</html>
